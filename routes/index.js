const express = require('express');
const router = express.Router();
const db = require('../app');

// Vulnerable SQL Injection route
router.get('/app/test/sql-injection', (req, res) => {
  const userId = req.query.id;

  // Unsafe query construction
  const query = `SELECT * FROM users WHERE id = ${userId}`;

  db.all(query, [], (err, rows) => {
    if (err) {
      return res.status(500).send("Database error");
    }

    res.json(rows);
  });
});



// Secure SQL Injection route
router.get('/app/fix/sql-injection', (req, res) => {
  const userId = req.query.id;

  // Use a parameterized query to prevent SQL injection
  const query = `SELECT * FROM users WHERE id = ?`;

  db.all(query, [userId], (err, rows) => {
    if (err) {
      return res.status(500).send("Database error");
    }

    res.json(rows);
  });
});


module.exports = router;