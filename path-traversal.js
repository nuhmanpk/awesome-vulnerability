const fs = require("fs").promises;
const path = require("path");
const express = require("express");
const app = express();

app.get("/read-file", async (req, res) => {
  const filename = req.query.filename;

  try {
    const filePath = path.join(__dirname, filename);
    const fileContent = await fs.readFile(filePath, "utf8");
    res.send(fileContent);
  } catch (err) {
    res.status(500).send("Error reading file");
  }
});

// Try accessing with localhost:3000/read-file?filename=./.env
app.listen(3000, () => {
  console.log("Server running on port 3000");
});

/* FIX
const filePath = path.resolve(uploadDir, filename);

Check if the resolved path is still within the uploadDir

if (!filePath.startsWith(uploadDir)) {
    return res.status(400).send('Invalid file path');
}

*/
